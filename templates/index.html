<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Japan Local Food</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .map-wrap { position: relative;}
    .map-img { width: 100%; height: auto; display:block; }
.hotspot {
  position:absolute;
  border:none !important;
  outline:none !important;
  border-radius:12px;
  cursor:pointer;
  background:rgba(0,0,0,0);
}
    .panel-card { box-shadow: 0 6px 18px rgba(0,0,0,.08); border: none; border-radius: 16px; }
    .hero-header {
  background: url("{{ url_for('static', filename='headder.png') }}")
              center/cover no-repeat;
  padding: 200px 100px;
  color: #fff;
  text-shadow: 0 2px 6px rgba(0,0,0,0.6);
}

.hero-title {
  font-size: 2rem;
  font-weight: 700;
}
   .add-btn-fixed {
  position: absolute;
  top: 200px;
  right: 0px;
  z-index: 1050;   /* 他の要素より前面に */
}

.add-btn-img {
  height: 250px;
  transition: transform 0.2s ease, filter 0.2s ease;
}
.add-btn-img:hover {
  transform: scale(1.08);
  filter: brightness(1.1);
}
/* タイトル文字を大きく */
#details .card-title {
  font-size: 2.5rem;   /* デフォは1.25remくらい → 少し大きめ */
  font-weight: 700;
}

/* 説明や詳細の本文 */
#details .card-text {
  font-size: 1.5rem;   /* デフォは1rem → 少し大きく */
  line-height: 1.6;    /* 行間を広げて読みやすく */
}



  </style>
</head>

<body class="bg-light">
<header class="hero-header">
  <div class="container d-flex align-items-center justify-content-between">
    <!-- 言語切替ボタン -->
    <div class="btn-group">
      <button class="btn btn-sm btn-outline-light" onclick="setLang('en')">English</button>
      <button class="btn btn-sm btn-outline-light" onclick="setLang('ja')">日本語</button>
    </div>

    <!-- ★ Addボタンはここに移動（右端） -->
    <a href="{{ url_for('add') }}" class="add-btn-fixed">
      <img src="{{ url_for('static', filename='add_button_cat.png') }}" alt="Add" class="add-btn-img">
    </a>
  </div>
</header>


</h1>

  </div>
</nav>
<main class="container">
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="p-3 bg-white rounded-3 border">
        <h5 class="mb-3">Prefecture Map</h5>
        <div class="map-wrap">
          <img id="japanMap" class="map-img" src="/static/map/japan_blocks.png" alt="Map">
          <div id="hotspots"></div>
        </div>
        <p class="text-secondary small mt-2">Click a prefecture tile to view foods on the right.</p>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="p-3 bg-white rounded-3 border">
        <h5 class="mb-3">Details</h5>
        <div id="details"><p class="text-secondary">Select a prefecture from the map.</p></div>
      </div>
    </div>
  </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
let lang = "en";       // デフォルト表示言語
let lastPref = null;   // 直前にクリックした都道府県

function setLang(l) {
  lang = l;
  // 見出しやヒントも切替（任意）
  const t = {
    en: { details: "Details", hint: "Click a prefecture tile to view foods on the right." },
    ja: { details: "詳細",   hint: "地図の都道府県をクリックすると右に表示されます。" }
  };
  const dTitle = document.getElementById("detailsTitle");
  const hint   = document.getElementById("mapHint");
  if (dTitle) dTitle.textContent = t[lang].details;
  if (hint)   hint.textContent   = t[lang].hint;

  // 直前の県があれば再描画
  if (lastPref) loadPref(lastPref);
}

async function j(u,opt){const r=await fetch(u,opt);return r.json()}
function renderDetails(pref, items){
  const el = document.getElementById('details');
  if(!items.length){ el.innerHTML=`<p class="text-secondary">No items for ${pref}. Use Add to register.</p>`; return; }
  el.innerHTML = items.map(it=>`
    <div class="card panel-card mb-3">
      <div class="row g-0">
        <div class="col-md-5">
          ${it.image_path?`<img src='/${it.image_path}' class='img-fluid rounded-start'>`:`<div class='bg-light d-flex align-items-center justify-content-center rounded-start' style='height:100%'>No image</div>`}
        </div>
        <div class="col-md-7"><div class="card-body">
<h5 class="card-title">
  ${lang === "en" ? it.dish_en : it.dish_ja}<br>
  ${lang === "en" ? it.prefecture_en : it.prefecture_ja}
</h5>
          <p class="card-text mb-1"><strong>Prefecture:</strong> ${it.prefecture_en} / ${it.prefecture_ja}</p>
          <p class="card-text mb-1"><strong>Category:</strong> ${it.category_en} · <strong>Region:</strong> ${it.region}</p>
          <p class="card-text">${
            lang === "en"
              ? (it.description_en || "")
              : (it.description_ja ? it.description_ja : (it.description_en || ""))
          }</p>

          ${it.source?`<a href='${it.source}' target='_blank' class='link-primary'>Source</a>`:""}
          <div class="mt-2">
            ${it.id?`<a class="btn btn-sm btn-outline-secondary" href="/edit/${it.id}">Edit</a>
            <form action="/delete/${it.id}" method="post" class="d-inline" onsubmit="return confirm('Delete this item?')">
              <button class="btn btn-sm btn-outline-danger">Delete</button>
            </form>`:""}
          </div>
        </div></div>
      </div>
    </div>
  `).join("");
}
async function loadPref(name){
  lastPref = name;  // ★ 選択した都道府県を記録（言語切替時に再表示するため）
  const data = await j('/api/pref?name='+encodeURIComponent(name));
  renderDetails(name, data.items||[]);
}

async function init(){
  const px = await j('/api/coords_px');
  const img = document.getElementById('japanMap');
  const layer = document.getElementById('hotspots');
  const draw = ()=>{
    const w = img.clientWidth, h = img.clientHeight;
    const sx = w/px.natural_width, sy = h/px.natural_height;
    layer.innerHTML='';
    layer.style.position='absolute'; layer.style.left=0; layer.style.top=0; layer.style.width=w+'px'; layer.style.height=h+'px';
    Object.entries(px.rects).forEach(([name,r])=>{
      const b = document.createElement('button');
      b.className='hotspot';
      b.style.left=(r.x*sx)+'px'; b.style.top=(r.y*sy)+'px'; b.style.width=(r.w*sx)+'px'; b.style.height=(r.h*sy)+'px';
      b.title=name; b.addEventListener('click',e=>{e.preventDefault(); loadPref(name)});
      layer.appendChild(b);
    });
  };
  if(img.complete) draw(); else img.onload=draw;
  addEventListener('resize', draw);
}
init();
</script>
</body>
</html>
